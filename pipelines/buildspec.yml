version: 0.2

run-as: root

env:
  shell: bash
  secrets-manager:
    DB_USERNAME: gardenplace-db-credentials:username
    DB_PASSWORD: gardenplace-db-credentials:password
    DB_HOST: gardenplace-db-credentials:host
    DB_PORT: gardenplace-db-credentials:port

phases:
  install:
    runtime-versions:
      golang: latest
  build:
    commands:
      - cd backend/authService
      - go build
    finally:
      - echo $(ls)
  post_build:
    commands:
      - |
        echo "
        {
          \"UserDBConnectionString\": \""$DB_USERNAME":"$DB_PASSWORD"@tcp("$DB_HOST":"$DB_PORT")/gardenplace\",
          \"UseTLS\": true,
          \"Port\": 9001,
          \"AllowedOrigins\": [\"https://www.showandtell.page\"]
        }" > config.json
    finally:
      - echo $(ls)
      - cd
artifacts:
  files:
    - backend/authService/gardenplace
    - backend/authService/config.json
    - appspec.yml
    - scripts/*